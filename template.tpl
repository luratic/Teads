___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Teads",
  "description": "This is an unofficial Google Tag Manager template for Teads.\nTeads to track the actions people take on your website, and to be able to analyze and optimize toward your marketing objectives.",
  "categories": [
    "MARKETING"
  ],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "displayName": "Custom template created by Luratic",
    "id": "brand_dummy",
    "thumbnail": "data:image/png;base64,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"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "advertiserId",
    "displayName": "Advertiser Id:",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "POSITIVE_NUMBER"
      }
    ],
    "help": "Introduce here advertiser identifier.",
    "valueHint": "12345"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const createQueue = require('createQueue');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const makeInteger = require('makeInteger');

//const log = require('logToConsole');

const url = 'https://p.teads.tv/teads-fellow.js';
const advertiserId = makeInteger(data.advertiserId);


createQueue('teads_e');
setInWindow('teads_adv_id', advertiserId);


injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, 'teads');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "teads_e"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "teads_adv_id"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://p.teads.tv/teads-fellow.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: gtmOnSuccess is invoked on injectScript success
  code: |-
    // test that gtmOnSuccess() is called when injectScript succeeds
    mock('injectScript', (url, onInjectionSuccess, onInjectionFailure) => {
      onInjectionSuccess();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: gtmOnFailure is invoked when injectScript fails
  code: |-
    // test gtmOnFailure() is called when injectScript fails
    mock('injectScript', (url, onInjectionSuccess, onInjectionFailure) => {
      onInjectionFailure();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify onFailure was called
    assertApi('gtmOnFailure').wasCalled();
- name: Do needed api calls when doesn't exist in window
  code: |
    // Call runCode to run the template's code.
    runCode();

    assertApi('setInWindow').wasCalled(1);
    assertApi('createQueue').wasCalled(1);
setup: ''


___NOTES___

Developed with ❤ by: Alfonso, Txema and Brais.
Web: www.luratic.com
Linkedin: 
https://www.linkedin.com/in/braiscalvo/
https://www.linkedin.com/in/alfonsorc/
https://www.linkedin.com/in/txema-s%C3%A1nchez-a48482ba/


